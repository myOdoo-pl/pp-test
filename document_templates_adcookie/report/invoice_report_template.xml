<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_invoice_document_adcookie" inherit_id="account.report_invoice_document">
        <xpath expr="//h2" position="inside">
            <t t-if="o.partner_id.lang == 'pl_PL'">
                <span t-if="o.move_type in ['in_refund', 'out_refund']">For Invoice No</span>
                <span t-if="o.move_type in ['in_refund', 'out_refund']" t-field="o.reversed_entry_id.name"/>
                <span t-if="o.move_type in ['in_refund', 'out_refund'] and o.reversed_entry_id.invoice_date">from</span>
                <span t-if="o.move_type in ['in_refund', 'out_refund']" t-field="o.reversed_entry_id.invoice_date"/>
            </t>
        </xpath>

        <xpath expr="//div[hasclass('row', 'mt32', 'mb32')]" position="attributes">
            <attribute name="t-if">o.partner_id.lang != 'pl_PL'</attribute>
        </xpath>

        <xpath expr="//t" position="replace">
            <t t-name="account.report_invoice_document">
                <t t-call="web.external_layout">
                    <t t-set="o" t-value="o.with_context({'lang': lang})"/>
                    <div class="row">
                        <div class="col-5" name="company_address" style="border-top: solid #f37224; text-align: center">
                            <p>
                                <strong  t-if="o.partner_id.lang == 'pl_PL'" style="color: #f37224">Sprzedawca</strong>
                                <strong  t-if="o.partner_id.lang != 'pl_PL'" style="color: #f37224">Seller</strong>
                            </p>
                            <span t-field="o.company_id"/>
                            <br/>
                            <span t-field="o.company_id.street"/>
                            <br/>
                            <span t-field="o.company_id.zip"/>
                            <span t-field="o.company_id.city"/>
                            <br/>
                            <span t-field="o.company_id.country_id"/>
                            <br/>
                            TIN:
                            <span t-field="o.company_id.vat"/>
                            <t t-if="o.partner_bank_id">
                                <br/>
                                <span t-field="o.partner_bank_id.bank_id.name"/>:
                                <br/>
                                <span t-field="o.partner_bank_id.acc_number"/>
                            </t>
                        </div>

                        <div name="invoice_address" class="col-5 offset-2"
                             style="border-top: solid #f37224; text-align: center">
                            <p>
                                <strong  t-if="o.partner_id.lang == 'pl_PL'" style="color: #f37224">Nabywca</strong>
                                <strong  t-if="o.partner_id.lang != 'pl_PL'" style="color: #f37224">Client</strong>
                            </p>
                            <address style="margin-bottom: 0" t-field="o.partner_id"
                                     t-options="{'widget': 'contact',
                                     'fields': ['address', 'name'], 'no_marker': True}"/>
                            TIN:
                            <span t-field="o.partner_id.vat"/>
                        </div>
                    </div>

                    <div class="page">
                        <br/>
                        <h2 style="text-align: center; color: #f37224; margin-top: 0">
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">VAT Invoice</span>
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'draft'">Draft Invoice</span>
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
                            <span t-if="o.move_type == 'out_refund'">Credit Note</span>
                            <span t-if="o.move_type == 'in_refund'">Vendor Credit Note</span>
                            <span t-if="o.move_type == 'in_invoice'">Vendor Bill</span>
                            <span t-field="o.name"/>
                        </h2>

                        <div class="row mt32 mb32">
                            <span class="col-auto" t-if="o.invoice_date" name="invoice_date">
                                <strong>Invoice Date:</strong>
                                <p t-field="o.invoice_date" t-options="{'widget': 'date'}"/>
                            </span>
                            <!-- CHANGED o.invoice_sale_date to o.date below -->
                            <span t-if="o.date" class="col-auto" name="sale_date">
                                <strong>Sale Date:</strong>
                                <p t-field="o.date" t-options="{'widget': 'date'}"/>
                            </span>
                            <span class="col-auto" name="sale_date"
                                t-if="o.main_so_id
                                and o.move_type in ('in_refund', 'out_refund', 'out_invoice')
                                and o.state in ('posted', 'in_payment', 'paid')">
                                <strong>Order Date:</strong>
                                <p t-field="o.main_so_id.date_order" t-options="{'widget': 'date'}"/>
                            </span>
                            <span class="col-auto" name="invoice_date_due"
                                  t-if="o.invoice_date_due and o.move_type == 'out_invoice' and o.state in ('posted', 'in_payment', 'paid')">
                                <strong>Due Date:</strong>
                                <p t-field="o.invoice_date_due" t-options="{'widget': 'date'}"/>
                            </span>
                        </div>

                        <div class="row mt32 mb32">
                            <span class="col-auto" t-if="o.name" name="description">
                                <strong>Description:</strong>
                                <p t-field="o.name"/>
                            </span>
                            <span class="col-auto" t-if="o.invoice_origin" name="invoice_origin">
                                <strong>Source:</strong>
                                <p t-field="o.invoice_origin"/>
                            </span>
                            <span class="col-auto" t-if="o.partner_id.ref" name="customer_code">
                                <strong>Customer Code:</strong>
                                <p t-field="o.partner_id.ref"/>
                            </span>
                            <span name="ref" class="col-auto" t-if="o.correction_ref">
                                <strong>Reference:</strong>
                                <p t-field="o.correction_ref"/>
                            </span>
                        </div>

                        <div class="row mt32 mb32" style="width: 700px">
                            <span name="reason" class="col-auto" t-if="o.move_type in ('in_refund', 'out_refund')">
                                <strong>Correction Reason:</strong>
                                <p t-field="o.correction_reason"/>
                            </span>
                        </div>

                        <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>
                        <t t-if="not o.reversed_entry_id">
                            <div style="border-top: solid #f37224; border-bottom: solid #f37224">
                                <table class="table table-sm" name="invoice_line_table" style="font-size: 12px">
                                    <thead>
                                        <tr>
                                            <t t-set="colspan" t-value="9"/>
                                            <th class="col-xs-1">
                                                <strong>No.</strong>
                                            </th>
                                            <th class="text-left">
                                                <span>Description</span>
                                            </th>
                                            <th class="col-xs-1 text-right">
                                                <strong>PKWiU No.</strong>
                                            </th>
                                            <th class="text-right">
                                                <span>Quantity</span>
                                            </th>
                                            <th t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                            if report_type == 'html' else '' }}">
                                                <span>Unit Price</span>
                                            </th>
                                            <th t-if="display_discount"
                                                t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                                if report_type == 'html' else '' }}">
                                                <span>Disc.(%)</span>
                                                <t t-set="colspan" t-value="colspan+1"/>
                                            </th>
                                            <th class="col-xs-1 text-right">
                                                <strong>VAT [%]</strong>
                                            </th>
                                            <th class="col-xs-2 text-right">
                                                <strong>Amount</strong>
                                            </th>
                                            <th t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                            if report_type == 'html' else '' }}">
                                                <span>Tax</span>
                                            </th>
                                            <th class="col-xs-2 text-right">
                                                <strong>Total Price</strong>
                                            </th>
                                        </tr>
                                    </thead>

                                    <tbody class="invoice_tbody">
                                        <t t-set="current_subtotal" t-value="0"/>
                                        <t t-set="i" t-value="1"/>
                                        <t t-foreach="o.invoice_line_ids" t-as="line">
                                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"
                                               groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_total"
                                               groups="account.group_show_line_subtotals_tax_included"/>
                                            <tr style="page-break-inside: avoid !important"
                                                t-att-class="'bg-200 font-weight-bold o_line_section'
                                                if line.display_type == 'line_section' else 'font-italic o_line_note'
                                                if line.display_type == 'line_note' else ''">
                                                <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                                    <td>
                                                        <span t-esc="i"/>
                                                    </td>
                                                    <t t-set="i" t-value="i+1"/>
                                                    <td name="account_invoice_line_name">
                                                        <span t-field="line.name"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="line.product_id.pkwiu"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="line.quantity"/>
                                                        <span t-field="line.uom_id" groups="uom.group_uom"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="line.price_unit"
                                                              t-options="{'widget': 'monetary',
                                                              'display_currency': o.currency_id}"/>
                                                    </td>
                                                    <td t-if="display_discount" class="text-right">
                                                        <span t-field="line.discount"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="', '.join(map(lambda x:
                                                        (x.description or x.name), line.tax_ids))"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="line.price_subtotal"
                                                              t-options="{'widget': 'monetary',
                                                              'display_currency': o.currency_id}"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="line.invoice_line_tax"
                                                              t-options="{'widget': 'monetary',
                                                              'display_currency': o.currency_id}"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="line.price_total"
                                                              t-options="{'widget': 'monetary',
                                                              'display_currency': o.currency_id}"/>
                                                    </td>
                                                </t>
                                                <t t-if="line.display_type == 'line_section'">
                                                    <td colspan="99">
                                                        <span t-field="line.name"/>
                                                    </td>
                                                    <t t-set="current_section" t-value="line"/>
                                                    <t t-set="current_subtotal" t-value="0"/>
                                                </t>
                                                <t t-if="line.display_type == 'line_note'">
                                                    <td colspan="99">
                                                        <span t-field="line.name"/>
                                                    </td>
                                                </t>
                                            </tr>

                                            <t t-if="current_section and (line_last or
                                            o.invoice_line_ids[line_index+1].display_type == 'line_section')">
                                                <tr class="is-subtotal text-right">
                                                    <td colspan="99">
                                                        <strong class="mr16">Subtotal</strong>
                                                        <span t-esc="current_subtotal"
                                                              t-options="{'widget': 'monetary',
                                                              'display_currency': o.currency_id}"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                    </tbody>
                                </table>
                            </div>

                            <div class="clearfix">
                                <div id="total" class="row">
                                    <div t-attf-class="#{'col-5' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
                                        <table class="table table-sm" style="font-size: 12px">
                                            <tr style="border-bottom: 1px solid #f37224">
                                                <td>
                                                    <strong>Subtotal</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-field="o.amount_untaxed"/>
                                                </td>
                                            </tr>

                                            <tr class="border-black">
                                                <td>
                                                    <strong>Total</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-field="o.amount_total"/>
                                                </td>
                                            </tr>
                                        </table>
                                        <br/>

                                        <table class="table table-sm text-center" style="font-size: 12px">
                                            <tr style="border-bottom: 1px solid #f37224">
                                                <th/>
                                                <th>
                                                    <strong>Tax</strong>
                                                </th>
                                                <th>
                                                    <strong>Untaxed Amount</strong>
                                                </th>
                                                <th>
                                                    <strong>Tax Amount</strong>
                                                </th>
                                                <th>
                                                    <strong>Taxed Amount</strong>
                                                </th>
                                            </tr>

                                            <tr style="border-bottom: 1px solid #f37224">
                                                <t t-set="recordset" t-value="o.line_tax_summing()"/>
                                                <td>
                                                    <strong>Taxes</strong>
                                                </td>

                                                <td class="text-center">
                                                    <t t-set="i" t-value="0"/>
                                                    <t t-foreach="recordset" t-as="record">
                                                        <span style="white-space: nowrap"
                                                              t-esc="o.get_dict_key(recordset, i)"/>
                                                        <t t-set="i" t-value="i+1"/>
                                                    </t>
                                                </td>

                                                <!--Net Value of tax-->
                                                <td class="text-center">
                                                    <t t-set="i" t-value="0"/>
                                                    <t t-foreach="recordset" t-as="record">
                                                        <span t-esc="o.get_dict_value_weight(recordset, i, 0)"
                                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                        <t t-set="i" t-value="i+1"/>
                                                    </t>
                                                </td>

                                                <!--Tax Value of tax-->
                                                <td class="text-center">
                                                    <t t-set="i" t-value="0"/>
                                                    <t t-foreach="recordset" t-as="record">
                                                        <span t-esc="o.get_dict_value_weight(recordset, i, 1)"
                                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                        <t t-set="i" t-value="i+1"/>
                                                    </t>
                                                </td>

                                                <!--Taxed Value of tax-->
                                                <td class="text-center">
                                                    <t t-set="i" t-value="0"/>
                                                    <t t-foreach="recordset" t-as="record">
                                                        <span t-esc="o.get_dict_value_weight(recordset, i, 2)"
                                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                        <t t-set="i" t-value="i+1"/>
                                                    </t>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </t>

                        <t t-else="o.reversed_entry_id">
                            <t t-set="foreign_cur" t-value="False"/>
                            <strong>Before refund</strong>
                            <div style="border-top: solid #f37224; border-bottom: solid #f37224">
                                <table class="table table-sm" style="font-size: 12px">
                                    <thead>
                                        <tr>
                                            <t t-set="colspan" t-value="9"/>
                                            <th class="col-xs-1">
                                                <strong>No.</strong>
                                            </th>
                                            <th class="text-left">
                                                <span>Description</span>
                                            </th>
                                            <th class="col-xs-1 text-right">
                                                <strong>PKWiU No.</strong>
                                            </th>
                                            <th class="text-right">
                                                <span>Quantity</span>
                                            </th>
                                            <th t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                            if report_type == 'html' else '' }}">
                                                <span>Unit Price</span>
                                            </th>
                                            <th t-if="display_discount"
                                                t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                                if report_type == 'html' else '' }}">
                                                <span>Disc.(%)</span>
                                                <t t-set="colspan" t-value="colspan+1"/>
                                            </th>
                                            <th class="col-xs-1 text-right">
                                                <strong>VAT [%]</strong>
                                            </th>
                                            <th class="col-xs-2 text-right">
                                                <strong>Amount</strong>
                                            </th>
                                            <th t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                            if report_type == 'html' else '' }}">
                                                <span>Tax</span>
                                            </th>
                                            <th class="col-xs-2 text-right">
                                                <strong>Total Price</strong>
                                            </th>
                                        </tr>
                                    </thead>

                                    <tbody class="invoice_tbody">
                                        <t t-set="current_subtotal" t-value="0"/>
                                        <t t-set="i" t-value="1"/>
                                        <t t-foreach="o.reversed_entry_id.invoice_line_ids" t-as="line_orig">
                                            <t t-set="current_subtotal"
                                               t-value="current_subtotal + line_orig.price_subtotal"
                                               groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <t t-set="current_subtotal"
                                               t-value="current_subtotal + line_orig.price_total"
                                               groups="account.group_show_line_subtotals_tax_included"/>
                                            <tr style="page-break-inside: avoid !important"
                                                t-att-class="'bg-200 font-weight-bold o_line_section'
                                                if line_orig.display_type == 'line_section'
                                                else 'font-italic o_line_note'
                                                if line_orig.display_type == 'line_note' else ''">
                                                <t t-if="not line_orig.display_type"
                                                   name="account_invoice_line_accountable">
                                                    <td>
                                                        <span t-esc="i"/>
                                                    </td>
                                                    <t t-set="i" t-value="i+1"/>
                                                    <td name="account_invoice_line_name">
                                                        <span t-field="line_orig.name"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="line_orig.product_id.pkwiu"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="line_orig.quantity"/>
                                                        <span t-field="l.uom_id" groups="uom.group_uom"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="line_orig.price_unit"
                                                              t-options='{"widget": "monetary",
                                                              "display_currency": o.reversed_entry_id.currency_id}'/>
                                                    </td>
                                                    <td t-if="display_discount" class="text-right">
                                                        <span t-field="line_orig.discount"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="', '.join(map(lambda x:
                                                        (x.description or x.name), line_orig.tax_ids))"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="line_orig.price_subtotal"
                                                              t-options='{"widget": "monetary",
                                                              "display_currency": o.reversed_entry_id.currency_id}'/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="line_orig.invoice_line_tax"
                                                              t-options='{"widget": "monetary",
                                                              "display_currency": o.reversed_entry_id.currency_id}'/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="line_orig.price_total"
                                                              t-options='{"widget": "monetary",
                                                              "display_currency": o.reversed_entry_id.currency_id}'/>
                                                    </td>
                                                </t>
                                                <t t-if="line_orig.display_type == 'line_section'">
                                                    <td colspan="99">
                                                        <span t-field="line_orig.name"/>
                                                    </td>
                                                    <t t-set="current_section" t-value="line"/>
                                                    <t t-set="current_subtotal" t-value="0"/>
                                                </t>
                                                <t t-if="line_orig.display_type == 'line_note'">
                                                    <td colspan="99">
                                                        <span t-field="line_orig.name"/>
                                                    </td>
                                                </t>
                                            </tr>

                                            <t t-if="current_section and (line_last or
                                            o.invoice_line_ids[line_index+1].display_type == 'line_section')">
                                                <tr class="is-subtotal text-right">
                                                    <td colspan="99">
                                                        <strong class="mr16">Subtotal</strong>
                                                        <span t-esc="current_subtotal"
                                                              t-options="{'widget': 'monetary',
                                                              'display_currency': o.currency_id}"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                            <br/>
                            <p style="page-break-after: always"/>

                            <strong>After refund</strong>
                            <div style="border-top: solid #f37224; border-bottom: solid #f37224">
                                <table class="table table-sm" style="font-size: 12px">
                                    <thead>
                                        <tr>
                                            <t t-set="colspan" t-value="9"/>
                                            <th class="col-xs-1">
                                                <strong>No.</strong>
                                            </th>
                                            <th class="text-left">
                                                <span>Description</span>
                                            </th>
                                            <th class="col-xs-1 text-right">
                                                <strong>PKWiU No.</strong>
                                            </th>
                                            <th class="text-right">
                                                <span>Quantity</span>
                                            </th>
                                            <th t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                            if report_type == 'html' else '' }}">
                                                <span>Unit Price</span>
                                            </th>
                                            <th t-if="display_discount"
                                                t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                                if report_type == 'html' else '' }}">
                                                <span>Disc.(%)</span>
                                                <t t-set="colspan" t-value="colspan+1"/>
                                            </th>
                                            <th class="col-xs-1 text-right">
                                                <strong>VAT [%]</strong>
                                            </th>
                                            <th class="col-xs-2 text-right">
                                                <strong>Amount</strong>
                                            </th>
                                            <th t-attf-class="text-right {{ 'd-none d-md-table-cell'
                                            if report_type == 'html' else '' }}">
                                                <span>Tax</span>
                                            </th>
                                            <th class="col-xs-2 text-right">
                                                <strong>Total Price</strong>
                                            </th>
                                        </tr>
                                    </thead>

                                    <tbody class="invoice_tbody">
                                        <t t-set="current_subtotal" t-value="0"/>
                                        <t t-set="i" t-value="1"/>
                                        <t t-foreach="o.correction_invoice_line_ids" t-as="l">
                                            <t t-set="current_subtotal" t-value="current_subtotal + l.price_subtotal"
                                               groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <t t-set="current_subtotal"
                                               t-value="current_subtotal + l.price_total"
                                               groups="account.group_show_line_subtotals_tax_included"/>
                                            <tr style="page-break-inside: avoid !important"
                                                t-att-class="'bg-200 font-weight-bold o_line_section'
                                                if l.display_type == 'line_section' else
                                                'font-italic o_line_note' if l.display_type == 'line_note'
                                                else ''">
                                                <t t-if="not l.display_type"
                                                   name="account_invoice_line_accountable">
                                                    <td>
                                                        <span t-esc="i"/>
                                                    </td>
                                                    <t t-set="i" t-value="i+1"/>
                                                    <td name="account_invoice_line_name">
                                                        <span t-field="l.name"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="l.product_id.pkwiu"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="l.quantity"/>
                                                        <span t-field="l.uom_id" groups="uom.group_uom"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="l.price_unit"
                                                              t-options='{"widget": "monetary",
                                                              "display_currency": o.currency_id}'/>
                                                    </td>
                                                    <td t-if="display_discount" class="text-right">
                                                        <span t-field="l.discount"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="', '.join(map(lambda x:
                                                        (x.description or x.name), l.invoice_line_tax_ids))"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="l.price_subtotal"
                                                              t-options='{"widget": "monetary",
                                                              "display_currency": o.reversed_entry_id.currency_id}'/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="l.invoice_line_tax"
                                                              t-options='{"widget": "monetary",
                                                              "display_currency": o.currency_id}'/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="l.price_total"
                                                              t-options='{"widget": "monetary",
                                                              "display_currency": o.currency_id}'/>
                                                    </td>
                                                </t>
                                                <t t-if="l.display_type == 'line_section'">
                                                    <td colspan="99">
                                                        <span t-field="l.name"/>
                                                    </td>
                                                    <t t-set="current_section" t-value="line"/>
                                                    <t t-set="current_subtotal" t-value="0"/>
                                                </t>
                                                <t t-if="l.display_type == 'line_note'">
                                                    <td colspan="99">
                                                        <span t-field="l.name"/>
                                                    </td>
                                                </t>
                                            </tr>

                                            <t t-if="current_section and (line_last or o.correction_invoice_line_ids[line_index+1].display_type == 'line_section')">
                                                <tr class="is-subtotal text-right">
                                                    <td colspan="99">
                                                        <strong class="mr16">Subtotal</strong>
                                                        <span t-esc="current_subtotal"
                                                              t-options="{'widget': 'monetary',
                                                              'display_currency': o.currency_id}"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                    </tbody>
                                </table>
                            </div>

                            <div class="clearfix">
                                <div id="total" class="row">
                                    <div t-attf-class="#{'col-5' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
                                        <table class="table table-sm" style="font-size: 12px">
                                            <tr style="border-bottom: 1px solid #f37224">
                                                <td>
                                                    <strong>Subtotal</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-field="o.correction_untaxed"/>
                                                </td>
                                            </tr>

                                            <tr style="border-bottom: 1px solid #f37224; border-width: thick">
                                                <td>
                                                    <strong>Total</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-field="o.correction_total"/>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td t-if="o.correction_residual &gt; 0 or o.correction_residual == 0">
                                                    <strong>To Pay(gross)</strong>
                                                </td>
                                                <td t-if="o.correction_residual &gt; 0 or o.correction_residual == 0" class="text-right">
                                                    <span t-esc="abs(o.correction_total)"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </td>
                                                <td t-if="o.correction_residual &lt; 0">
                                                    <strong>Amount Left to Pay</strong>
                                                </td>
                                                <td t-if="o.correction_residual &lt; 0" class="text-right">
                                                    <span t-esc="abs(o.correction_residual)"
                                                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </td>
                                            </tr>
                                        </table>
                                        <br/>

                                        <table class="table table-sm text-center" style="font-size: 12px">
                                            <tr style="border-bottom: 1px solid #f37224">
                                                <th/>
                                                <th>
                                                    <strong>Tax</strong>
                                                </th>
                                                <th>
                                                    <strong>Untaxed Amount</strong>
                                                </th>
                                                <th>
                                                    <strong>Tax Amount</strong>
                                                </th>
                                                <th>
                                                    <strong>Taxed Amount</strong>
                                                </th>
                                            </tr>

                                            <tr style="border-bottom: 1px solid #f37224">
                                                <t t-set="recordset" t-value="o.correction_line_tax_summing()"/>
                                                <td>
                                                    <strong>Taxes</strong>
                                                </td>

                                                <td class="text-center">
                                                    <t t-set="i" t-value="0"/>
                                                    <t t-foreach="recordset" t-as="record">
                                                        <span style="white-space: nowrap"
                                                              t-esc="o.get_dict_key(recordset, i)"/>
                                                        <t t-set="i" t-value="i+1"/>
                                                    </t>
                                                </td>

                                                <td class="text-center">
                                                    <t t-set="i" t-value="0"/>
                                                    <t t-foreach="recordset" t-as="record">
                                                        <span t-esc="o.get_dict_value_weight(recordset, i, 0)"
                                                        t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                        <t t-set="i" t-value="i+1"/>
                                                    </t>
                                                </td>

                                                <td class="text-center">
                                                    <t t-set="i" t-value="0"/>
                                                    <t t-foreach="recordset" t-as="record">
                                                        <span t-esc="o.get_dict_value_weight(recordset, i, 1)"
                                                        t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                        <t t-set="i" t-value="i+1"/>
                                                    </t>
                                                </td>

                                                <td class="text-center">
                                                    <t t-set="i" t-value="0"/>
                                                    <t t-foreach="recordset" t-as="record">
                                                        <span t-esc="o.get_dict_value_weight(recordset, i, 2)"
                                                        t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                        <t t-set="i" t-value="i+1"/>
                                                    </t>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <br/>
                        </t>

                        <div class="col-6 offset-3" style="text-align: center">
                            <p t-if="o.narration" name="narration">
                                <span t-field="o.narration"/>
                            </p>
                            <p t-if="o.invoice_payment_term_id" name="invoice_payment_term">
                                <span t-field="o.invoice_payment_term_id.note"/>
                            </p>
                            <p t-if="o.fiscal_position_id.note" name="note">
                                <span t-field="o.fiscal_position_id.note"/>
                            </p>
                        </div>

                        <div id="qrcode"
                             t-if="(o.partner_id.country_id.code in ['BE', 'AT', 'DE', 'FI', 'NL'])
                             and (o.company_id.qr_code) and (o.currency_id.name == 'EUR')
                             and (o.partner_bank_id.acc_number != False)">
                            <p t-if="(o.partner_bank_id.qr_code_valid)">
                                <strong class="text-center">Scan me with your banking app.</strong>
                                <br/>
                                <br/>
                                <img class="border border-dark rounded"
                                     t-att-src="o.partner_bank_id.build_qr_code_url(o.residual,(o.reference)
                                     if (o.reference) else o.number)"/>
                            </p>
                            <p t-if="(o.partner_bank_id.qr_code_valid == False)">
                                <strong class="text-center">The SEPA QR Code informations are not set correctly.
                                </strong>
                                <br/>
                            </p>
                        </div>
                    </div>
                </t>
            </t>
        </xpath>
    </template>
</odoo>
